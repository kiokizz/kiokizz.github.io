<!DOCtype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Splinterlands Reward Cards Stats</title>
    <script src="https://cdn.jsdelivr.net/npm/steem/dist/steem.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

</head>

<body>

    <p id="body1"></p>
    <p id="displayStats">Data Loading...</p>
    <p id="body2"></p>

    <style>
        body {
            width: 100%;
            max-width: 750px;
            font-size: 12pt;
        }

        table {
            width: 100%;
        }

        table,
        td,
        th {
            border: 1px solid black;
            border-collapse: collapse;
        }

        .btn {
            border: none;
            background-color: inherit;
            cursor: pointer;
            font-weight: bold;
        }

        .btn:hover {
            background: rgb(202, 189, 189);
        }
    </style>


    <script>
        var body1 = "Data regarding the remaining reward edition cards for Splinterlands.<br>"

        document.getElementById("body1").innerHTML = body1;

        var body2 =
            "Disclaimer: Human error could result in mistakes in the representation of the above data; no waranty express or implied is provided. Extracted from https://steemmonsters.com/cards/get_details.<br>" +
            "<br><a href=\"https://github.com/kiokizz\">GitHub</a> | Check out my Steem blogs <a href=\"https://www.steemit.com/@kiokizz\">@kiokizz</a> & <a href=\"https://www.steemit.com/@kiobot\">@kiobot</a>"

        document.getElementById("body2").innerHTML = body2;

        getRewardCards();

        function getRewardCards() {

            let url = "https://steemmonsters.com/cards/get_details";

            $.get(url, url, function (data) {
                console.log(data);

                let rewardCards = [];
                if (data) {
                    for (let i = 0; i < data.length; i++) {
                        const e = data[i];
                        if (e.editions === "3") rewardCards.push(e);
                    }
                }
                calculations(rewardCards);
            });
        }

        let data = [];
        let sorted = {};

        function calculations(rewardCards) {
            let cardCap = [0, 400000, 100000, 40000, 10000]
            let xp = [0, 15, 75, 175, 750];
            let gxp = [0, 200, 400, 800, 2000];
            let rarities = {
                1: "Common",
                2: "Rare",
                3: "Epic",
                4: "Legendary"
            }

            for (let i = 0; i < rewardCards.length; i++) {
                //Stat data
                let c = {}
                let e = rewardCards[i];

                c.card = e.name;
                c.rarity = rarities[e.rarity];
                c.bcxNormExist = parseInt(e.distribution[0].total_xp) / xp[e.rarity] + parseInt(e.distribution[0]
                    .num_cards);
                c.bcxGoldExist = parseInt(e.distribution[1].total_xp) / gxp[e.rarity];
                c.bcxExist = c.bcxNormExist + c.bcxGoldExist;
                c.nBCXBurn = parseInt(e.distribution[0].total_burned_xp) / xp[e.rarity] + parseInt(e.distribution[0]
                    .num_burned);
                c.gBCXBurn = parseInt(e.distribution[1].total_burned_xp) / gxp[e.rarity];
                c.bcxBurn = c.nBCXBurn + c.gBCXBurn;
                c.bcxTotal = e.total_printed;
                c.yBCXTotal = c.bcxExist + c.bcxBurn;
                c.bcxPercent = parseFloat(e.total_printed / cardCap[e.rarity] * 100).toFixed(2) + "%";

                //CSS Requirements
                c.color = e.color;

                data.push(c);
            }

            makeTable(data);
        }

        function makeTable(data) {
            let header =
                "<table><tr><th><button id=\"card_btn\" class=\"btn\">Card</button><button id=\"color_btn\" class=\"btn\">(color)</button></th>" +
                "<th><button id=\"rarity_btn\" class=\"btn\">Rarity</button></th>" +
                "<th><button id=\"normal_btn\" class=\"btn\">Normal BCX Existing</button></th>" +
                "<th><button id=\"gold_btn\" class=\"btn\">Gold BCX Existing</button></th>" +
                "<th><button id=\"burn_btn\" class=\"btn\">BCX Burned</button></th>" +
                "<th>Total BCX</th>" +
                "<th><button id=\"percent_btn\" class=\"btn\">Percentage Printed</button></th></tr>";

            let rows = "";

            for (let i = 0; i < data.length; i++) {
                //Style
                const e = data[i];

                let cardCss;
                if (e.color === "Black") cardCss = "style=\"background-color:" + e.color + ";color:rgb(201, 201, 201)" +
                    "\"";
                else if (e.color === "Blue") cardCss = "style=\"background-color:" + e.color + ";color:white" + "\"";
                else cardCss = "style=\"background-color:" + e.color + "\"";
                let rowData =
                    "<tr><td " + cardCss + ">" + e.card + "</td><td>" + e.rarity +
                    "</td><td>" + e.bcxNormExist + "</td><td>" + e.bcxGoldExist + "</td><td>" + e.bcxBurn +
                    "</td><td>" +
                    e.bcxTotal + "</td><td>" + e.bcxPercent + "</td></tr>";

                rows += rowData;
            }

            let footer = "</table>";
            table = header + rows + footer;

            createHTMLPage(table);
        }

        function createHTMLPage(table) {
            document.getElementById("displayStats").innerHTML = table;

            //Buttons
            document.getElementById("card_btn").onclick = function () {
                sortTable("card")
            };
            document.getElementById("color_btn").onclick = function () {
                sortTable("color")
            };
            document.getElementById("rarity_btn").onclick = function () {
                sortTable("rarity")
            };
            document.getElementById("normal_btn").onclick = function () {
                sortTable("bcxNormExist")
            };
            document.getElementById("gold_btn").onclick = function () {
                sortTable("bcxGoldExist")
            };
            document.getElementById("burn_btn").onclick = function () {
                sortTable("bcxBurn")
            };
            document.getElementById("percent_btn").onclick = function () {
                sortTable("bcxPercent")
            };
        }

        function sortTable(column) {
            if (!sorted[column]) sorted[column] = 1;
            else sorted[column] *= -1;
            data.sort(function (a, b) {
                if (a[column] > b[column]) {
                    return 1 * sorted[column];
                } else {
                    return -1 * sorted[column];
                }
            });
            makeTable(data);
        }
    </script>

</body>

</html>
